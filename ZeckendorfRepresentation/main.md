# Zeckendorf Representation

Each new term in the Fibonacci sequence is generated by adding the previous two terms.<br />
Starting with 1 and 2, the first 10 terms will be: 1, 2, 3, 5, 8, 13, 21, 34, 55, 89.

Every positive integer can be uniquely written as a sum of nonconsecutive terms of the Fibonacci sequence. For example, 100 = 3 + 8 + 89.<br />
Such a sum is called the <b>Zeckendorf representation</b> of the number.

For any integer <var>n</var>&gt;0, let <var>z</var>(<var>n</var>) be the number of terms in the Zeckendorf representation of <var>n</var>.<br />
Thus, <var>z</var>(5) = 1, <var>z</var>(14) = 2, <var>z</var>(100) = 3 etc.<br />
Also, for 0&lt;<var>n</var>&lt;10<sup>6</sup>, <span style="font-size:larger;"><span style="font-size:larger;">∑</span></span> <var>z</var>(<var>n</var>) = 7894453.

Find <span style="font-size:larger;"><span style="font-size:larger;">∑</span></span> <var>z</var>(<var>n</var>) for 0&lt;<var>n</var>&lt;10<sup>17</sup>.

## Solution

### Zeckendorf Representation

In the problem it is stated that the Zeckendorf representation exists and is unique for all natural numbers. Let $F_i$ be the largest fibonacci number smaller than or equal to $n$. Then $a := n - F_i < F_{i + 1} - F_i = F_{i - 1}$. Therefore the largest possible fibonacci number in the Zeckendorf representation of $a$ is $F_{i - 2}$. Therefore the Zeckendorf representation of $a$ plus $F_i$ gives us the Zeckendorf representation of $n$. Thus there is a greedy algorithm to obtain the Zeckendorf representation of $n$, where at each stage we choose the largest possible Fibonacci number we can.

### Final Solution

Let

$$
z(0) = 0 \\
S(N) = \sum_{0 \leq n \leq N} z(n) \\
$$

Notice that because, the largest fibonacci number smaller than or equal to $n$ is in the representation of $n$ then

$$
\begin{align*}
S(N)
&= 1 + N - 1 + \sum_{2 \leq n \leq N} (z(n) - 1) \\
&= N + \sum_{i \leq 3} \sum_{\substack{2 \leq n \leq N \\ \\ F_i \leq n < F_{i + 1}}} (z(n) - 1) \\
&= N + \sum_{i \leq 3} \sum_{\substack{0 \leq n \leq N - F_i \\ \\ n < F_{i + 1} - F_i}} (1 + z(n) - 1) \\
&= N + \sum_{i \leq 3} \sum_{\substack{0 \leq n \leq N - F_i \\ \\ n < F_{i - 1}}} z(n) \\
\end{align*}
$$

If $F_{i - 1} \leq N - F_i \Rightarrow F_{i + 1} \leq N$ then

$$
\sum_{\substack{0 \leq n \leq N - F_i \\ \\ n < F_{i - 1}}} z(n)
= \sum_{0 \leq n < F_{i - 1}} z(n)
= S(F_{i - 1} - 1)
$$

If $F_i \leq N$

$$
\sum_{\substack{0 \leq n \leq N - F_i \\ \\ n < F_{i - 1}}} z(n)
= \sum_{0 \leq n \leq N - F_i} z(n)
= S(N - F_i)
$$

otherwise

$$
\sum_{\substack{0 \leq n \leq N - F_i \\ \\ n < F_{i - 1}}} z(n) = 0
$$

Finally, the calculation of $S$ can be sped up using memoization.